---
title: "Nucléaire militaire"
author: "Elucid"
date: "2025-03-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

# Chargement des packages et données

## Packages

```{r}
library(tidyverse)
library(corrplot)
```

## Données

Les données sont chargées depus le fichier Excel fourni par Olivier et les variables sont renommées pour être plus faciles à manipuler.

```{r}
data <- readxl::read_xlsx("../raw_data/Intérêt.xlsx")

var_names <- c("pays",
            "pays_code",
            "possede_ou_a_possede_bombe",
            "prog_nucl",
            "pop",
            "surf",
            "pib",
            "pib_ppa",
            "pib_par_hab_ppa",
            "prix_scientif",
            "nucleaire_civil",
            "membre_otan_ou_eq_pre_1990",
            "membre_otan_2025",
            "danger_frontieres",
            "interet_politique")

data <- data %>% 
  set_names(var_names)

# pb de valeurs zéro dans pib_ppa (dans ce cas on observe pib_par_hab_ppa manquante) => transformations en NA
data <- data %>% 
  mutate(pib_ppa = ifelse(is.na(pib_par_hab_ppa), NA, pib_ppa))
```

## Un peu de mise en forme pour les graphiques

On en profite pour distinguer les variables par catégorie : quantitative, discrète ou binaire, ce qui permet ensuite de les représenter graphiquement de manière appropriée.

```{r}
var_booleenes <- c(
  "possede_ou_a_possede_bombe",
  "prog_nucl",
  "nucleaire_civil",
  "membre_otan_ou_eq_pre_1990",
  "membre_otan_2025",
  "interet_politique"
)

var_discretes <- c("prix_scientif",
                   "danger_frontieres")

var_quantitatives <-
  setdiff(setdiff(var_names, c("pays", "pays_code")),
          c(var_booleenes, var_discretes))


data_long <- data %>%
  pivot_longer(
    cols = !starts_with("pays"),
    names_to = "variable",
    values_to = "valeur"
  ) %>%
  mutate(
    type_variable = case_when(
      variable %in% var_booleenes ~ "booleene",
      variable %in% var_discretes ~ "discrete",
      TRUE ~ "quantitative"
    ),
    valeur = ifelse(is.na(valeur), 0 , valeur)
  )
```

# Analyses univariées

## Distributions

### Variables quantitatives

```{r}
data_long %>% 
  filter(type_variable == "quantitative") %>% 
  ggplot(aes(x = valeur)) +
    geom_histogram() +
    facet_wrap(~variable, scales = "free") +
  labs(x = "valeur", 
       y = "nombre de pays")
```

On beaucoup de valeurs faibles et quelques valeurs très élevées $\Rightarrow$ test en log_transformant les variables.

```{r}
data_long %>% 
  filter(type_variable == "quantitative") %>% 
  ggplot(aes(x = valeur)) +
    geom_histogram() +
    facet_wrap(~variable, scales = "free") +
  labs(x = "valeur", 
       y = "nombre de pays") +
  scale_x_log10()
```

En vue de la modélisation, pour approcher des distributions gaussiennes, on retiendra des valeurs log-transformées.

```{r}
# transformation log sur data
data <- data %>% 
  mutate(across(.cols = var_quantitatives,
                .fns = ~log(1 + .)))

# on reconstruit data_long avec les valeurs log-transformées
data_long <- data %>%
  pivot_longer(
    cols = !starts_with("pays"),
    names_to = "variable",
    values_to = "valeur"
  ) %>%
  mutate(
    type_variable = case_when(
      variable %in% var_booleenes ~ "booleene",
      variable %in% var_discretes ~ "discrete",
      TRUE ~ "quantitative"
    ),
    valeur = ifelse(is.na(valeur), 0 , valeur)
  )
```


### Variables discrètes

```{r}
data_long %>% 
  filter(type_variable == "discrete") %>% 
  ggplot(aes(x = valeur)) +
    geom_histogram() +
    facet_wrap(~variable, scales = "free") +
  labs(x = "valeur", 
       y = "nombre de pays")
```

Distributions assez moches car beaucoup de valeurs nulles. A affiner.

### Variables binaires

```{r}
data_long %>% 
  filter(type_variable == "booleene") %>% 
  ggplot(aes(x = valeur)) +
    geom_bar() +
    facet_wrap(~variable) +
  labs(x = "valeur", 
       y = "nombre de pays") +
  scale_x_continuous(breaks = c(0, 1), labels = c("Non", "Oui"))
```

## Cartographie




### Variables discrètes

### Variables binaires

## Conclusions

>A Verifier :

>d'après le tableau, pas de nucléaire civil au RU ?

>Pas de prix scientifiques en Chine, USA ou Russie ?

# Relations bivariées

Il va de soi que tous les pays dotés de la bombe se sont auparavant dotés de programmes nucléaires.

On va s'intéresser aux relations entre les variables prises deux à deux pour :

- identifier de potentiels prédicteurs des variables que l'on cherche à expliquer (si le pays possède la bombe, s'il a développé un programme sur le nucléaire militaire).

### Variables quantitatives

Ci-dessous les pays pour lesquels il manque des données sont exclus (n = 10).

```{r}
correlations <- data %>% 
  select(var_quantitatives) %>% 
  na.omit() %>% # suppression des pays où il manque des données
  mutate_all(.funs = ~log10(.)) %>% 
  cor(use = "pairwise.complete.obs")

corrplot.mixed(correlations, upper = "ellipse")
```

On a des corrélations positives et fortes entre *pib_ppa, pib* et *pop*, voire avec *surf*. Sans surprise *surf* et *pop* sont assez corrélés, les "grands" pays ayant en général des populations supérieures à celles des "petits" pays. La variable *pib_par_hab_ppa* est peu corrélée aux autres variables.

## Variables quantitatives et qualitatives

```{r}
test <- data %>% 
  select(pays_code, var_quantitatives) %>% 
  pivot_longer(cols = -pays_code, names_to = "var_quant_nom", values_to = "var_quant_valeur")

test2 <- data %>% 
  select(pays_code, var_discretes, var_booleenes) %>% 
  pivot_longer(cols = -pays_code, names_to = "var_qual_nom", values_to = "var_qual_valeur")

croise <- expand.grid(var_quantitatives, c(var_discretes, var_booleenes), unique(data$pays_code)) %>% 
  set_names("var_quant_nom", "var_qual_nom", "pays_code")

test3 <- croise %>% 
  left_join(y = test) %>% 
  left_join(y = test2)
```


```{r}
ggplot(data = test3,
       aes(x = as.factor(var_qual_valeur),
           y = var_quant_valeur)) +
  geom_boxplot() +
  facet_grid(var_quant_nom ~ var_qual_nom,
             scales = "free") 
```


```{r}
data %>% 
  #filter(variable %in% c("possede_ou_a_possede_bombe", "pib_par_hab_ppa")) %>% 
  mutate(possede_ou_a_possede_bombe = as.factor(possede_ou_a_possede_bombe)) %>% 
  ggplot(aes(x = possede_ou_a_possede_bombe, y = pib_par_hab_ppa)) +
  geom_boxplot()
```

```{r}
var_qual <- "possede_ou_a_possede_bombe"
var_quant <- "pib_par_hab_ppa"

data_long %>% 
  filter(variable %in% c(var_qual, var_quant)) %>%
  mutate(var_qual = as.factor(var_qual)) %>% 
  ggplot(aes(x = as.factor(var_qual), y = var_quant)) +
  geom_boxplot()
```
```{r}
mon_boxplot (df = data_long,
             var_qual = possede_ou_a_possede_bombe,
             var_quant = pib_par_hab_ppa)
```

